<<<<<<< HEAD
bongiovi=window.bongiovi||{};(function(){var a=function(){this.matrix=mat4.create();mat4.identity(this.matrix)},b=a.prototype;b.lookAt=function(a,c,h){mat4.identity(this.matrix);mat4.lookAt(this.matrix,a,c,h)};b.getMatrix=function(){return this.matrix};bongiovi.Camera=a})();bongiovi=window.bongiovi||{};(function(){var a=bongiovi.Camera,b=function(){a.call(this);this.projection=mat4.create();mat4.identity(this.projection);this.mtxFinal=mat4.create()},e=b.prototype=new a;e.setPerspective=function(a,e,b,f){mat4.perspective(this.projection,a,e,b,f)};e.getMatrix=function(){mat4.multiply(this.mtxFinal,this.projection,this.matrix);return this.mtxFinal};bongiovi.CameraPerspective=b})();(function(a){a=function(){this._passes=[]};var b=a.prototype=new bongiovi.Pass;b.addPass=function(a){this._passes.push(a)};b.render=function(a){this.texture=a;for(a=0;a<this._passes.length;a++)this.texture=this._passes[a].render(this.texture);return this.texture};b.getTexture=function(){return this.texture};bongiovi.EffectComposer=a})();(function(){var a,b=function(c,e,b,f){a=bongiovi.GLTool.gl;this.width=c;this.height=e;this.magFilter=void 0==b?a.LINEAR:b;this.minFilter=void 0==f?a.LINEAR:f;this._init()},e=b.prototype;e._init=function(){this.depthTextureExt=a.getExtension("WEBKIT_WEBGL_depth_texture");this.texture=a.createTexture();this.depthTexture=a.createTexture();this.glTexture=new GLTexture(this.texture,!0);this.glDepthTexture=new GLTexture(this.depthTexture,!0);this.frameBuffer=a.createFramebuffer();a.bindFramebuffer(a.FRAMEBUFFER,
this.frameBuffer);this.frameBuffer.width=this.width;this.frameBuffer.height=this.height;a.bindTexture(a.TEXTURE_2D,this.texture);a.texParameteri(a.TEXTURE_2D,a.TEXTURE_MAG_FILTER,this.magFilter);a.texParameteri(a.TEXTURE_2D,a.TEXTURE_MIN_FILTER,this.minFilter);a.texParameteri(a.TEXTURE_2D,a.TEXTURE_WRAP_S,a.CLAMP_TO_EDGE);a.texParameteri(a.TEXTURE_2D,a.TEXTURE_WRAP_T,a.CLAMP_TO_EDGE);this.magFilter==a.NEAREST&&this.minFilter==a.NEAREST?a.texImage2D(a.TEXTURE_2D,0,a.RGBA,this.frameBuffer.width,this.frameBuffer.height,
0,a.RGBA,a.FLOAT,null):a.texImage2D(a.TEXTURE_2D,0,a.RGBA,this.frameBuffer.width,this.frameBuffer.height,0,a.RGBA,a.UNSIGNED_BYTE,null);a.generateMipmap(a.TEXTURE_2D);a.bindTexture(a.TEXTURE_2D,this.depthTexture);a.texParameteri(a.TEXTURE_2D,a.TEXTURE_MAG_FILTER,a.NEAREST);a.texParameteri(a.TEXTURE_2D,a.TEXTURE_MIN_FILTER,a.NEAREST);a.texParameteri(a.TEXTURE_2D,a.TEXTURE_WRAP_S,a.CLAMP_TO_EDGE);a.texParameteri(a.TEXTURE_2D,a.TEXTURE_WRAP_T,a.CLAMP_TO_EDGE);null!=this.depthTextureExt&&a.texImage2D(a.TEXTURE_2D,
0,a.DEPTH_COMPONENT,this.width,this.height,0,a.DEPTH_COMPONENT,a.UNSIGNED_SHORT,null);a.framebufferTexture2D(a.FRAMEBUFFER,a.COLOR_ATTACHMENT0,a.TEXTURE_2D,this.texture,0);if(null==this.depthTextureExt){console.log("no depth texture");var c=a.createRenderbuffer();a.bindRenderbuffer(a.RENDERBUFFER,c);a.renderbufferStorage(a.RENDERBUFFER,a.DEPTH_COMPONENT16,this.frameBuffer.width,this.frameBuffer.height);a.framebufferRenderbuffer(a.FRAMEBUFFER,a.DEPTH_ATTACHMENT,a.RENDERBUFFER,c)}else a.framebufferTexture2D(a.FRAMEBUFFER,
a.DEPTH_ATTACHMENT,a.TEXTURE_2D,this.depthTexture,0);a.bindTexture(a.TEXTURE_2D,null);a.bindRenderbuffer(a.RENDERBUFFER,null);a.bindFramebuffer(a.FRAMEBUFFER,null)};e.bind=function(){a.bindFramebuffer(a.FRAMEBUFFER,this.frameBuffer)};e.unbind=function(){a.bindFramebuffer(a.FRAMEBUFFER,null)};e.getTexture=function(){return this.glTexture};e.getDepthTexture=function(){return this.glDepthTexture};bongiovi.Framebuffer=b})();(function(){var a=function(a,c){this.gl=bongiovi.GL.gl;this.idVertex=a;this.idFragment=c;this.parameters=[];this.uniformTextures=[];this.fragmentShader=this.vertexShader=void 0;this._isReady=!1;this._loadedCount=0;this.init()},b=a.prototype;b.init=function(){this.getShader(this.idVertex,!0);this.getShader(this.idFragment,!1)};b.getShader=function(a,c){var h=new XMLHttpRequest;h.hasCompleted=!1;var b=this;h.onreadystatechange=function(a){4==a.target.readyState&&(c?b.createVertexShaderProgram(a.target.responseText):
b.createFragmentShaderProgram(a.target.responseText))};h.open("GET",a,!0);h.send(null)};b.createVertexShaderProgram=function(a){var c=this.gl.createShader(this.gl.VERTEX_SHADER);this.gl.shaderSource(c,a);this.gl.compileShader(c);if(!this.gl.getShaderParameter(c,this.gl.COMPILE_STATUS))return console.warn(this.gl.getShaderInfoLog(c)),null;this.vertexShader=c;void 0!=this.vertexShader&&void 0!=this.fragmentShader&&this.attachShaderProgram();this._loadedCount++};b.createFragmentShaderProgram=function(a){var c=
this.gl.createShader(this.gl.FRAGMENT_SHADER);this.gl.shaderSource(c,a);this.gl.compileShader(c);if(!this.gl.getShaderParameter(c,this.gl.COMPILE_STATUS))return console.warn(this.gl.getShaderInfoLog(c)),null;this.fragmentShader=c;void 0!=this.vertexShader&&void 0!=this.fragmentShader&&this.attachShaderProgram();this._loadedCount++};b.attachShaderProgram=function(){this._isReady=!0;this.shaderProgram=this.gl.createProgram();this.gl.attachShader(this.shaderProgram,this.vertexShader);this.gl.attachShader(this.shaderProgram,
this.fragmentShader);this.gl.linkProgram(this.shaderProgram)};b.bind=function(){this._isReady&&(this.gl.useProgram(this.shaderProgram),void 0==this.shaderProgram.pMatrixUniform&&(this.shaderProgram.pMatrixUniform=this.gl.getUniformLocation(this.shaderProgram,"uPMatrix")),void 0==this.shaderProgram.mvMatrixUniform&&(this.shaderProgram.mvMatrixUniform=this.gl.getUniformLocation(this.shaderProgram,"uMVMatrix")),bongiovi.GLTool.setShader(this),bongiovi.GLTool.setShaderProgram(this.shaderProgram),this.uniformTextures=
[])};b.isReady=function(){return this._isReady};b.uniform=function(a,c,h){if(this._isReady){"texture"==c&&(c="uniform1i");for(var b=!1,f,l=0;l<this.parameters.length;l++)if(f=this.parameters[l],f.name==a){f.value=h;b=!0;break}b?this.shaderProgram[a]=f.uniformLoc:(this.shaderProgram[a]=this.gl.getUniformLocation(this.shaderProgram,a),this.parameters.push({name:a,type:c,value:h,uniformLoc:this.shaderProgram[a]}));if(-1==c.indexOf("Matrix"))this.gl[c](this.shaderProgram[a],h);else this.gl[c](this.shaderProgram[a],
!1,h);"uniform1i"==c&&(this.uniformTextures[h]=this.shaderProgram[a])}};b.unbind=function(){};bongiovi.GLShader=a})();(function(){var a,b,e=function(c,e){a=bongiovi.GL.gl;b=bongiovi.GL;void 0!=e?this.texture=c:(this.texture=a.createTexture(),this._isVideo="VIDEO"==c.tagName,a.bindTexture(a.TEXTURE_2D,this.texture),a.pixelStorei(a.UNPACK_FLIP_Y_WEBGL,!0),a.texImage2D(a.TEXTURE_2D,0,a.RGBA,a.RGBA,a.UNSIGNED_BYTE,c),a.texParameteri(a.TEXTURE_2D,a.TEXTURE_MAG_FILTER,a.LINEAR),a.texParameteri(a.TEXTURE_2D,a.TEXTURE_MIN_FILTER,a.LINEAR),a.texParameteri(a.TEXTURE_2D,a.TEXTURE_WRAP_S,a.MIRRORED_REPEAT),a.texParameteri(a.TEXTURE_2D,
a.TEXTURE_WRAP_T,a.MIRRORED_REPEAT),a.generateMipmap(a.TEXTURE_2D),a.bindTexture(a.TEXTURE_2D,null))},c=e.prototype;c.updateTexture=function(c){a.bindTexture(a.TEXTURE_2D,this.texture);a.pixelStorei(a.UNPACK_FLIP_Y_WEBGL,!0);a.texImage2D(a.TEXTURE_2D,0,a.RGBA,a.RGBA,a.UNSIGNED_BYTE,c);this._isVideo?(a.texParameteri(a.TEXTURE_2D,a.TEXTURE_MAG_FILTER,a.LINEAR),a.texParameteri(a.TEXTURE_2D,a.TEXTURE_MIN_FILTER,a.LINEAR)):(a.texParameteri(a.TEXTURE_2D,a.TEXTURE_MAG_FILTER,a.LINEAR),a.texParameteri(a.TEXTURE_2D,
a.TEXTURE_MIN_FILTER,a.LINEAR_MIPMAP_NEAREST),a.generateMipmap(a.TEXTURE_2D));a.bindTexture(a.TEXTURE_2D,null)};c.bind=function(c,e){void 0==c&&(c=0);a.activeTexture(a.TEXTURE0+c);a.bindTexture(a.TEXTURE_2D,this.texture);a.uniform1i(b.shader.uniformTextures[c],c);this._bindIndex=c};c.unbind=function(){a.bindTexture(a.TEXTURE_2D,null)};bongiovi.GLTexture=e})();bongiovi=window.bongiovi||{};
(function(){var a=null,b=function(){this.aspectRatio=window.innerWidth/window.innerHeight;this.fieldOfView=45;this.zNear=5;this.zFar=3E3;this.gl=this.canvas=null;this.H=this.W=0;this.shaderProgram=this.shader=null},e=b.prototype;e.init=function(a){this.canvas=a;this.gl=this.canvas.getContext("experimental-webgl",{antialias:!0});this.resize();this.gl.getParameter(this.gl.SAMPLES);this.gl.getContextAttributes();this.gl.viewport(0,0,this.gl.viewportWidth,this.gl.viewportHeight);this.gl.enable(this.gl.DEPTH_TEST);
this.gl.enable(this.gl.CULL_FACE);this.gl.enable(this.gl.BLEND);this.gl.clearColor(0,0,0,1);this.gl.clearDepth(1);this.matrix=mat4.create();mat4.identity(this.matrix);this.depthTextureExt=this.gl.getExtension("WEBKIT_WEBGL_depth_texture");this.floatTextureExt=this.gl.getExtension("OES_texture_float");this.enableAlphaBlending();var e=this;window.addEventListener("resize",function(){e.resize()})};e.getGL=function(){return this.gl};e.setShader=function(a){this.shader=a};e.setShaderProgram=function(a){this.shaderProgram=
a};e.setViewport=function(a,e,b,f){this.gl.viewport(a,e,b,f)};e.setMatrices=function(a){this.camera=a};e.rotate=function(a){mat4.copy(this.matrix,a)};e.render=function(){null!=this.shaderProgram&&(this.gl.clear(this.gl.COLOR_BUFFER_BIT|this.gl.DEPTH_BUFFER_BIT),this.gl.blendFunc(this.gl.SRC_ALPHA,this.gl.ONE_MINUS_SRC_ALPHA))};e.enableAlphaBlending=function(){this.gl.blendFunc(this.gl.SRC_ALPHA,this.gl.ONE_MINUS_SRC_ALPHA)};e.enableAdditiveBlending=function(){this.gl.blendFunc(this.gl.ONE,this.gl.ONE)};
e.clear=function(a,e,b,f){this.gl.clearColor(a,e,b,f);this.gl.clear(this.gl.COLOR_BUFFER_BIT|this.gl.DEPTH_BUFFER_BIT)};e.draw=function(a){function e(a,c,b){void 0==c.cacheAttribLoc&&(c.cacheAttribLoc={});void 0==c.cacheAttribLoc[b]&&(c.cacheAttribLoc[b]=a.getAttribLocation(c,b));return c.cacheAttribLoc[b]}this.gl.uniformMatrix4fv(this.shaderProgram.pMatrixUniform,!1,this.camera.getMatrix());this.gl.uniformMatrix4fv(this.shaderProgram.mvMatrixUniform,!1,this.matrix);this.gl.bindBuffer(this.gl.ARRAY_BUFFER,
a.vBufferPos);var b=e(this.gl,this.shaderProgram,"aVertexPosition");this.gl.vertexAttribPointer(b,a.vBufferPos.itemSize,this.gl.FLOAT,!1,0,0);this.gl.enableVertexAttribArray(b);this.gl.bindBuffer(this.gl.ARRAY_BUFFER,a.vBufferUV);b=e(this.gl,this.shaderProgram,"aTextureCoord");this.gl.vertexAttribPointer(b,a.vBufferUV.itemSize,this.gl.FLOAT,!1,0,0);this.gl.enableVertexAttribArray(b);this.gl.bindBuffer(this.gl.ELEMENT_ARRAY_BUFFER,a.iBuffer);for(b=0;b<a.extraAttributes.length;b++){this.gl.bindBuffer(this.gl.ARRAY_BUFFER,
a.extraAttributes[b].buffer);var f=e(this.gl,this.shaderProgram,a.extraAttributes[b].name);this.gl.vertexAttribPointer(f,a.extraAttributes[b].itemSize,this.gl.FLOAT,!1,0,0);this.gl.enableVertexAttribArray(f)}a.drawType==this.gl.POINTS?this.gl.drawArrays(a.drawType,0,a.vertexSize):this.gl.drawElements(a.drawType,a.iBuffer.numItems,this.gl.UNSIGNED_SHORT,0)};e.resize=function(){this.W=window.innerWidth;this.H=window.innerHeight;this.canvas.width=this.W;this.canvas.height=this.H;this.gl.viewportWidth=
this.W;this.gl.viewportHeight=this.H;this.gl.viewport(0,0,this.W,this.H);this.aspectRatio=window.innerWidth/window.innerHeight;this.render()};b.getInstance=function(){null==a&&(a=new b);return a};bongiovi.GL=b.getInstance();bongiovi.GLTool=b.getInstance()})();(function(){var a=function(a,c,b){this.gl=bongiovi.GLTool.gl;this.vertexSize=a;this.indexSize=c;this.drawType=b;this.extraAttributes=[];this._floatArrayVertex=this.vBufferPos=void 0;this._init()},b=a.prototype;b._init=function(){};b.bufferVertex=function(a){for(var c=[],b=0;b<a.length;b++)for(var g=0;g<a[b].length;g++)c.push(a[b][g]);void 0==this.vBufferPos&&(this.vBufferPos=this.gl.createBuffer());this.gl.bindBuffer(this.gl.ARRAY_BUFFER,this.vBufferPos);if(void 0==this._floatArrayVertex)this._floatArrayVertex=
new Float32Array(c);else if(a.length!=this._floatArrayVertex.length)this._floatArrayVertex=new Float32Array(c);else for(b=0;b<a.length;b++)this._floatArrayVertex[b]=a[b];this.gl.bufferData(this.gl.ARRAY_BUFFER,this._floatArrayVertex,this.gl.STATIC_DRAW);this.vBufferPos.itemSize=3};b.bufferTexCoords=function(a){for(var c=[],b=0;b<a.length;b++)for(var g=0;g<a[b].length;g++)c.push(a[b][g]);this.vBufferUV=this.gl.createBuffer();this.gl.bindBuffer(this.gl.ARRAY_BUFFER,this.vBufferUV);this.gl.bufferData(this.gl.ARRAY_BUFFER,
new Float32Array(c),this.gl.STATIC_DRAW);this.vBufferUV.itemSize=2};b.bufferData=function(a,c,b){for(var g=-1,f=0;f<this.extraAttributes.length;f++)if(this.extraAttributes[f].name==c){this.extraAttributes[f].data=a;g=f;break}for(var l=[],f=0;f<a.length;f++)for(var m=0;m<a[f].length;m++)l.push(a[f][m]);if(-1==g)f=this.gl.createBuffer(),this.gl.bindBuffer(this.gl.ARRAY_BUFFER,f),g=new Float32Array(l),this.gl.bufferData(this.gl.ARRAY_BUFFER,g,this.gl.STATIC_DRAW),this.extraAttributes.push({name:c,data:a,
itemSize:b,buffer:f,floatArray:g});else{f=this.extraAttributes[g].buffer;this.gl.bindBuffer(this.gl.ARRAY_BUFFER,f);g=this.extraAttributes[g].floatArray;for(f=0;f<l.length;f++)g[f]=l[f];this.gl.bufferData(this.gl.ARRAY_BUFFER,g,this.gl.STATIC_DRAW)}};b.bufferIndices=function(a){this.iBuffer=this.gl.createBuffer();this.gl.bindBuffer(this.gl.ELEMENT_ARRAY_BUFFER,this.iBuffer);this.gl.bufferData(this.gl.ELEMENT_ARRAY_BUFFER,new Uint16Array(a),this.gl.STATIC_DRAW);this.iBuffer.itemSize=1;this.iBuffer.numItems=
a.length};bongiovi.Mesh=a})();define(["require"],function(a){a=function(a){this.strObj=a;this.positions=[];this.coords=[];this.indices=[];this.verticesCount=0;this.vertices=[];this.normals=[];this.vertexNormals=[];this.uvs=[];this.faces=[];this._parse()};a.prototype._parse=function(){for(var a=/v( +[\d|\.|\+|\-|e|E]+)( +[\d|\.|\+|\-|e|E]+)( +[\d|\.|\+|\-|e|E]+)/,e=/vn( +[\d|\.|\+|\-|e|E]+)( +[\d|\.|\+|\-|e|E]+)( +[\d|\.|\+|\-|e|E]+)/,c=/vt( +[\d|\.|\+|\-|e|E]+)( +[\d|\.|\+|\-|e|E]+)/,h=/f( +-?\d+)( +-?\d+)( +-?\d+)( +-?\d+)?/,
g=/f( +(-?\d+)\/(-?\d+))( +(-?\d+)\/(-?\d+))( +(-?\d+)\/(-?\d+))( +(-?\d+)\/(-?\d+))?/,f=/f( +(-?\d+)\/(-?\d+)\/(-?\d+))( +(-?\d+)\/(-?\d+)\/(-?\d+))( +(-?\d+)\/(-?\d+)\/(-?\d+))( +(-?\d+)\/(-?\d+)\/(-?\d+))?/,l=/f( +(-?\d+)\/\/(-?\d+))( +(-?\d+)\/\/(-?\d+))( +(-?\d+)\/\/(-?\d+))( +(-?\d+)\/\/(-?\d+))?/,m=this.strObj.split("\n"),n=0;n<m.length;n++){var k=m[n],k=k.trim(),d;0!==k.length&&"#"!==k.charAt(0)&&(null!==(d=a.exec(k))?this.vertices.push([parseFloat(d[1]),parseFloat(d[2]),parseFloat(d[3])]):
null!==(d=e.exec(k))?this.vertexNormals.push([parseFloat(d[1]),parseFloat(d[2]),parseFloat(d[3])]):null!==(d=c.exec(k))?this.uvs.push([parseFloat(d[1]),parseFloat(d[2])]):null!==(d=h.exec(k))?(faces.push([parseInt(d[1])-1,parseInt(d[2])-1,parseInt(d[3])-1]),positions.push([this.vertices[parseInt(d[1])-1],this.vertices[parseInt(d[2])-1],this.vertices[parseInt(d[3])-1]]),this.indices.push(this.verticesCount++),this.indices.push(this.verticesCount++),this.indices.push(this.verticesCount++)):null!==(d=
g.exec(k))?(void 0==d[11]?(this.positions.push(this.vertices[parseInt(d[2])-1]),this.positions.push(this.vertices[parseInt(d[5])-1]),this.positions.push(this.vertices[parseInt(d[8])-1]),this.coords.push(this.uvs[parseInt(d[3])-1]),this.coords.push(this.uvs[parseInt(d[6])-1]),this.coords.push(this.uvs[parseInt(d[9])-1])):(this.positions.push(this.vertices[parseInt(d[11])-1]),this.positions.push(this.vertices[parseInt(d[5])-1]),this.positions.push(this.vertices[parseInt(d[2])-1]),this.coords.push(this.uvs[parseInt(d[12])-
1]),this.coords.push(this.uvs[parseInt(d[6])-1]),this.coords.push(this.uvs[parseInt(d[3])-1]),this.indices.push(this.verticesCount++),this.indices.push(this.verticesCount++),this.indices.push(this.verticesCount++),this.positions.push(this.vertices[parseInt(d[11])-1]),this.positions.push(this.vertices[parseInt(d[8])-1]),this.positions.push(this.vertices[parseInt(d[5])-1]),this.coords.push(this.uvs[parseInt(d[12])-1]),this.coords.push(this.uvs[parseInt(d[9])-1]),this.coords.push(this.uvs[parseInt(d[6])-
1])),this.indices.push(this.verticesCount++),this.indices.push(this.verticesCount++),this.indices.push(this.verticesCount++)):null!==(d=f.exec(k))?(void 0==d[14]?(this.positions.push(this.vertices[parseInt(d[2])-1]),this.positions.push(this.vertices[parseInt(d[6])-1]),this.positions.push(this.vertices[parseInt(d[10])-1]),this.coords.push(this.uvs[parseInt(d[3])-1]),this.coords.push(this.uvs[parseInt(d[7])-1]),this.coords.push(this.uvs[parseInt(d[11])-1]),this.normals.push(this.vertexNormals[parseInt(d[4])-
1]),this.normals.push(this.vertexNormals[parseInt(d[8])-1]),this.normals.push(this.vertexNormals[parseInt(d[12])-1])):(this.positions.push(this.vertices[parseInt(d[2])-1]),this.positions.push(this.vertices[parseInt(d[6])-1]),this.positions.push(this.vertices[parseInt(d[14])-1]),this.coords.push(this.uvs[parseInt(d[3])-1]),this.coords.push(this.uvs[parseInt(d[7])-1]),this.coords.push(this.uvs[parseInt(d[15])-1]),this.normals.push(this.vertexNormals[parseInt(d[4])-1]),this.normals.push(this.vertexNormals[parseInt(d[8])-
1]),this.normals.push(this.vertexNormals[parseInt(d[16])-1]),this.indices.push(this.verticesCount++),this.indices.push(this.verticesCount++),this.indices.push(this.verticesCount++),this.positions.push(this.vertices[parseInt(d[6])-1]),this.positions.push(this.vertices[parseInt(d[10])-1]),this.positions.push(this.vertices[parseInt(d[14])-1]),this.coords.push(this.uvs[parseInt(d[7])-1]),this.coords.push(this.uvs[parseInt(d[11])-1]),this.coords.push(this.uvs[parseInt(d[15])-1]),this.normals.push(this.vertexNormals[parseInt(d[8])-
1]),this.normals.push(this.vertexNormals[parseInt(d[12])-1]),this.normals.push(this.vertexNormals[parseInt(d[16])-1])),this.indices.push(this.verticesCount++),this.indices.push(this.verticesCount++),this.indices.push(this.verticesCount++)):null!==l.exec(k)&&console.log("Face 4"))}};return a});(function(){var a,b=function(c,e,b){a=bongiovi.GL;void 0!=c&&(this.view="string"==typeof c?new bongiovi.ViewCopy("assets/shaders/copy.vert",c):c,this.width=void 0==e?512:e,this.height=void 0==b?512:b,this._init())},e=b.prototype;e._init=function(){this.fbo=new bongiovi.FrameBuffer(this.width,this.height);this.fbo.bind();a.setViewport(0,0,this.fbo.width,this.fbo.height);a.clear(0,0,0,0);this.fbo.unbind()};e.render=function(c){a.setViewport(0,0,this.fbo.width,this.fbo.height);this.fbo.bind();a.clear(0,
0,0,0);this.view.render(c);this.fbo.unbind();return this.fbo.getTexture()};e.getTexture=function(){return this.fbo.getTexture()};bongiovi.Pass=b})();(function(){var a=function(){this.gl=bongiovi.GLTool.gl;this._init()},b=a.prototype;b._init=function(){this.camera=new bongiovi.CameraPerspective;this.camera.setPerspective(45,window.innerWidth/window.innerHeight,5,3E3);var a=vec3.clone([0,0,500]),c=vec3.create(),b=vec3.clone([0,-1,0]);this.camera.lookAt(a,c,b);this.sceneRotation=new bongiovi.SceneRotation;this.rotationFront=mat4.create();mat4.identity(this.rotationFront);this.cameraOtho=new bongiovi.Camera;this._initTextures();this._initViews()};
b._initTextures=function(){};b._initViews=function(){};b.loop=function(){this.update();this.render()};b.update=function(){this.gl.clear(this.gl.COLOR_BUFFER_BIT|this.gl.DEPTH_BUFFER_BIT);this.sceneRotation.update();bongiovi.GLTool.setMatrices(this.camera);bongiovi.GLTool.rotate(this.sceneRotation.matrix)};b.render=function(){};bongiovi.Scene=a})();bongiovi=window.bongiovi||{};
(function(){var a=function(a){void 0==a&&(a=document);this._isRotateZ=this._preZ=this._mouseZ=this._z=0;this.matrix=mat4.create();this.m=mat4.create();this._vZaxis=vec3.clone([0,0,0]);this._zAxis=vec3.clone([0,0,-1]);this.preMouse={x:0,y:0};this.mouse={x:0,y:0};this._isMouseDown=!1;this._rotation=quat.clone([0,0,1,0]);this.tempRotation=quat.clone([0,0,0,0]);this._currDiffY=this._currDiffX=this.diffY=this.diffX=this._rotateZMargin=0;this._offset=0.0040;this._easing=0.1;this._slerp=-1;var c=this;a.addEventListener("mousedown",
function(a){c._onMouseDown(a)});a.addEventListener("touchstart",function(a){c._onMouseDown(a)});a.addEventListener("mouseup",function(a){c._onMouseUp(a)});a.addEventListener("touchend",function(a){c._onMouseUp(a)});a.addEventListener("mousemove",function(a){c._onMouseMove(a)});a.addEventListener("touchmove",function(a){c._onMouseMove(a)});a.addEventListener("mousewheel",function(a){c._onMouseWheel(a)});a.addEventListener("DOMMouseScroll",function(a){c._onMouseWheel(a)})},b=a.prototype;b.getMousePos=
function(a){var c;void 0!=a.changedTouches?(c=a.changedTouches[0].pageX,a=a.changedTouches[0].pageY):(c=a.clientX,a=a.clientY);return{x:c,y:a}};b._onMouseDown=function(a){if(!this._isMouseDown){a=this.getMousePos(a);var c=quat.clone(this._rotation);this._updateRotation(c);this._rotation=c;this._isMouseDown=!0;this._isRotateZ=0;this.preMouse={x:a.x,y:a.y};if(a.y<this._rotateZMargin||a.y>window.innerHeight-this._rotateZMargin)this._isRotateZ=1;else if(a.x<this._rotateZMargin||a.x>window.innerWidth-
this._rotateZMargin)this._isRotateZ=2;this._z=this._preZ;this._currDiffY=this.diffY=this._currDiffX=this.diffX=0}};b._onMouseMove=function(a){this.mouse=this.getMousePos(a)};b._onMouseUp=function(a){this._isMouseDown&&(this._isMouseDown=!1)};b._onMouseWheel=function(a){a.preventDefault();var c=a.wheelDelta;a=a.detail;this._preZ-=5*(a?c?0<c/a/40*a?1:-1:-a/3:c/120)};b.setCameraPos=function(a){console.log("Set camera pos : ",a);if(!(0<this._slerp)){var c=a.clone(this._rotation);this._updateRotation(c);
this._rotation=a.clone(c);this._currDiffY=this.diffY=this._currDiffX=this.diffX=0;this._isMouseDown=!1;this._isRotateZ=0;this._targetQuat=a.clone(a);this._slerp=1}};b.resetQuat=function(){this._rotation=quat.clone([0,0,1,0]);this.tempRotation=quat.clone([0,0,0,0]);this._targetQuat=void 0;this._slerp=-1};b.update=function(){mat4.identity(this.m);void 0==this._targetQuat?(quat.set(this.tempRotation,this._rotation[0],this._rotation[1],this._rotation[2],this._rotation[3]),this._updateRotation(this.tempRotation)):
(this._slerp+=0.1*(0-this._slerp),0.0010>this._slerp?(quat.set(this._rotation,this._targetQuat[0],this._targetQuat[1],this._targetQuat[2],this._targetQuat[3]),this._targetQuat=void 0,this._slerp=-1):(quat.set(this.tempRotation,0,0,0,0),quat.slerp(this.tempRotation,this._targetQuat,this._rotation,this._slerp)));vec3.set(this._vZaxis,0,0,this._z);vec3.transformQuat(this._vZaxis,this._vZaxis,this.tempRotation);mat4.translate(this.m,this.m,this._vZaxis);Math.random();mat4.fromQuat(this.matrix,this.tempRotation);
mat4.multiply(this.matrix,this.matrix,this.m)};b._updateRotation=function(a){this._isMouseDown&&!this._isLocked&&(this.diffX=this.mouse.x-this.preMouse.x,this.diffY=-(this.mouse.y-this.preMouse.y),this._isInvert&&(this.diffX=-this.diffX),this._isInvert&&(this.diffY=-this.diffY));this._currDiffX+=(this.diffX-this._currDiffX)*this._easing;this._currDiffY+=(this.diffY-this._currDiffY)*this._easing;if(0<this._isRotateZ){if(1==this._isRotateZ)var c=-this._currDiffX*this._offset,c=c*(this.preMouse.y<this._rotateZMargin?
-1:1),b=quat.clone([0,0,Math.sin(c),Math.cos(c)]);else c=-this._currDiffY*this._offset,c*=this.preMouse.x<this._rotateZMargin?1:-1,b=quat.clone([0,0,Math.sin(c),Math.cos(c)]);quat.multiply(quat,a,b)}else c=vec3.clone([this._currDiffX,this._currDiffY,0]),b=vec3.create(),vec3.cross(b,c,this._zAxis),vec3.normalize(b,b),c=vec3.length(c)*this._offset,b=quat.clone([Math.sin(c)*b[0],Math.sin(c)*b[1],Math.sin(c)*b[2],Math.cos(c)]),quat.multiply(a,a,b);this._z+=(this._preZ-this._z)*this._easing};bongiovi.SceneRotation=
a})();bongiovi=window.bongiovi||{};void 0==window.requestAnimFrame&&(window.requestAnimFrame=function(){return window.requestAnimationFrame||window.webkitRequestAnimationFrame||window.mozRequestAnimationFrame||window.oRequestAnimationFrame||window.msRequestAnimationFrame||function(a){window.setTimeout(a,1E3/60)}}());
(function(){var a=function(){this.FRAMERATE=60;this._delayTasks=[];this._nextTasks=[];this._deferTasks=[];this._highTasks=[];this._usurpTask=[];this._enterframeTasks=[];this._idTable=0;requestAnimFrame(this._loop.bind(this))},b=a.prototype;b._loop=function(){requestAnimFrame(this._loop.bind(this));this._process()};b._process=function(){for(var a=0;a<this._enterframeTasks.length;a++){var c=this._enterframeTasks[a];null!=c&&void 0!=c&&c.func.apply(c.scope,c.params)}for(;0<this._highTasks.length;)c=
this._highTasks.pop(),c.func.apply(c.scope,c.params);for(var b=(new Date).getTime(),a=0;a<this._delayTasks.length;a++)c=this._delayTasks[a],b-c.time>c.delay&&(c.func.apply(c.scope,c.params),this._delayTasks.splice(a,1));b=(new Date).getTime();for(a=1E3/this.FRAMERATE;0<this._deferTasks.length;){var c=this._deferTasks.shift(),g=(new Date).getTime();if(g-b<a)c.func.apply(c.scope,c.params);else{this._deferTasks.unshift(c);break}}b=(new Date).getTime();for(a=1E3/this.FRAMERATE;0<this._usurpTask.length;)if(c=
this._usurpTask.shift(),g=(new Date).getTime(),g-b<a)c.func.apply(c.scope,c.params);else break;this._highTasks=this._highTasks.concat(this._nextTasks);this._nextTasks=[];this._usurpTask=[]};b.addEF=function(a,c,b){b=b||[];var g=this._idTable;this._enterframeTasks[g]={scope:a,func:c,params:b};this._idTable++;return g};b.removeEF=function(a){void 0!=this._enterframeTasks[a]&&(this._enterframeTasks[a]=null);return-1};b.delay=function(a,c,b,g){var f=(new Date).getTime();this._delayTasks.push({scope:a,
func:c,params:b,delay:g,time:f})};b.defer=function(a,c,b){this._deferTasks.push({scope:a,func:c,params:b})};b.next=function(a,c,b){this._nextTasks.push({scope:a,func:c,params:b})};b.usurp=function(a,c,b){this._usurpTask.push({scope:a,func:c,params:b})};bongiovi.Scheduler=new a})();bongiovi=window.bongiovi||{};
(function(){SimpleImageLoader=function(){this._imgs={};this._toLoadCount=this._loadedCount=0;this._callbackProgress=this._callback=this._scope=void 0};var a=SimpleImageLoader.prototype;a.load=function(a,e,c,h){this._imgs={};this._loadedCount=0;this._toLoadCount=a.length;this._scope=e;this._callback=c;this._callbackProgress=h;var g=this;for(e=0;e<a.length;e++){c=new Image;c.onload=function(){g._onImageLoaded()};h=a[e];var f=h.split("/"),f=f[f.length-1].split(".")[0];this._imgs[f]=c;c.src=h}};a._onImageLoaded=
function(){this._loadedCount++;if(this._loadedCount==this._toLoadCount)this._callback.call(this._scope,this._imgs);else{var a=this._loadedCount/this._toLoadCount;this._callbackProgress&&this._callbackProgress.call(this._scope,a)}}})();bongiovi.SimpleImageLoader=new SimpleImageLoader;(function(){var a=function(a,c){void 0!=a&&(this.shader=new bongiovi.GLShader(a,c),this._init())},b=a.prototype;b._init=function(){console.log("Should be overwritten by SuperClass")};b.render=function(){console.log("Should be overwritten by SuperClass")};bongiovi.View=a})();(function(){var a=bongiovi.View,b=function(c,b){void 0==c&&(c="assets/shaders/copy.vert",b="assets/shaders/copy.frag");a.call(this,c,b)},e=b.prototype=new a;e._init=function(){var a=[],b=[];a.push([-1,-1,0]);a.push([1,-1,0]);a.push([1,1,0]);a.push([-1,1,0]);b.push([0,0]);b.push([1,0]);b.push([1,1]);b.push([0,1]);this.mesh=new bongiovi.Mesh(4,6,bongiovi.GLTool.gl.TRIANGLES);this.mesh.bufferVertex(a);this.mesh.bufferTexCoords(b);this.mesh.bufferIndices([0,1,2,0,2,3])};e.render=function(a){this.shader.isReady()&&
(this.shader.bind(),this.shader.uniform("texture","uniform1i",0),a.bind(0),bongiovi.GLTool.draw(this.mesh))};bongiovi.ViewCopy=b})();
=======
!function t(i,e,s){function r(n,a){if(!e[n]){if(!i[n]){var h="function"==typeof require&&require;if(!a&&h)return h(n,!0);if(o)return o(n,!0);var u=new Error("Cannot find module '"+n+"'");throw u.code="MODULE_NOT_FOUND",u}var f=e[n]={exports:{}};i[n][0].call(f.exports,function(t){var e=i[n][1][t];return r(e?e:t)},f,f.exports,t,i,e,s)}return e[n].exports}for(var o="function"==typeof require&&require,n=0;n<s.length;n++)r(s[n]);return r}({1:[function(t){console.log("Library bongiovi V1.0.0");t("../../js/bongiovi/Scheduler.js"),t("../../js/bongiovi/SimpleImageLoader.js"),t("../../js/bongiovi/GLTool.js"),t("../../js/bongiovi/SceneRotation.js"),t("../../js/bongiovi/Scene.js"),t("../../js/bongiovi/Camera.js"),t("../../js/bongiovi/CameraPerspective.js"),t("../../js/bongiovi/Mesh.js"),t("../../js/bongiovi/GLShader.js"),t("../../js/bongiovi/GLTexture.js"),t("../../js/bongiovi/View.js"),t("../../js/bongiovi/ViewCopy.js"),t("../../js/bongiovi/FrameBuffer.js"),t("../../js/bongiovi/Pass.js"),t("../../js/bongiovi/EffectComposer.js")},{"../../js/bongiovi/Camera.js":2,"../../js/bongiovi/CameraPerspective.js":3,"../../js/bongiovi/EffectComposer.js":4,"../../js/bongiovi/FrameBuffer.js":5,"../../js/bongiovi/GLShader.js":6,"../../js/bongiovi/GLTexture.js":7,"../../js/bongiovi/GLTool.js":8,"../../js/bongiovi/Mesh.js":9,"../../js/bongiovi/Pass.js":10,"../../js/bongiovi/Scene.js":11,"../../js/bongiovi/SceneRotation.js":12,"../../js/bongiovi/Scheduler.js":13,"../../js/bongiovi/SimpleImageLoader.js":14,"../../js/bongiovi/View.js":15,"../../js/bongiovi/ViewCopy.js":16}],2:[function(){bongiovi=window.bongiovi||{},function(){var t=function(){this.matrix=mat4.create(),mat4.identity(this.matrix)},i=t.prototype;i.lookAt=function(t,i,e){mat4.identity(this.matrix),mat4.lookAt(this.matrix,t,i,e)},i.getMatrix=function(){return this.matrix},bongiovi.Camera=t}()},{}],3:[function(){bongiovi=window.bongiovi||{},function(){{var t=bongiovi.Camera,i=function(){t.call(this),this.projection=mat4.create(),mat4.identity(this.projection),this.mtxFinal=mat4.create()},e=i.prototype=new t;t.prototype}e.setPerspective=function(t,i,e,s){mat4.perspective(this.projection,t,i,e,s)},e.getMatrix=function(){return mat4.multiply(this.mtxFinal,this.projection,this.matrix),this.mtxFinal},bongiovi.CameraPerspective=i}()},{}],4:[function(){!function(){{var t=function(){this.texture,this._passes=[]},i=t.prototype=new bongiovi.Pass;bongiovi.Pass.prototype}i.addPass=function(t){this._passes.push(t)},i.render=function(t){this.texture=t;for(var i=0;i<this._passes.length;i++)this.texture=this._passes[i].render(this.texture);return this.texture},i.getTexture=function(){return this.texture},bongiovi.EffectComposer=t}()},{}],5:[function(){!function(){var t,i=bongiovi.GLTexture,e=function(t){return!(0==t||t&t-1)},s=function(i,s,r){t=bongiovi.GLTool.gl,r=r||{},this.width=i,this.height=s,this.magFilter=r.magFilter||t.LINEAR,this.minFilter=r.minFilter||t.LINEAR_MIPMAP_NEAREST,this.wrapS=r.wrapS||t.MIRRORED_REPEAT,this.wrapT=r.wrapT||t.MIRRORED_REPEAT,e(i)&&e(s)||(this.wrapS=this.wrapT=t.CLAMP_TO_EDGE,this.minFilter==t.LINEAR_MIPMAP_NEAREST&&(this.minFilter=t.LINEAR)),this._init()},r=s.prototype;r._init=function(){this.depthTextureExt=t.getExtension("WEBKIT_WEBGL_depth_texture"),this.texture=t.createTexture(),this.depthTexture=t.createTexture(),this.glTexture=new i(this.texture,!0),this.glDepthTexture=new i(this.depthTexture,!0),this.frameBuffer=t.createFramebuffer(),t.bindFramebuffer(t.FRAMEBUFFER,this.frameBuffer),this.frameBuffer.width=this.width,this.frameBuffer.height=this.height;this.width;if(t.bindTexture(t.TEXTURE_2D,this.texture),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_MAG_FILTER,this.magFilter),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_MIN_FILTER,this.minFilter),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_WRAP_S,t.CLAMP_TO_EDGE),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_WRAP_T,t.CLAMP_TO_EDGE),this.magFilter==t.NEAREST&&this.minFilter==t.NEAREST?t.texImage2D(t.TEXTURE_2D,0,t.RGBA,this.frameBuffer.width,this.frameBuffer.height,0,t.RGBA,t.FLOAT,null):t.texImage2D(t.TEXTURE_2D,0,t.RGBA,this.frameBuffer.width,this.frameBuffer.height,0,t.RGBA,t.UNSIGNED_BYTE,null),this.minFilter==t.LINEAR_MIPMAP_NEAREST&&t.generateMipmap(t.TEXTURE_2D),t.bindTexture(t.TEXTURE_2D,this.depthTexture),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_MAG_FILTER,t.NEAREST),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_MIN_FILTER,t.NEAREST),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_WRAP_S,t.CLAMP_TO_EDGE),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_WRAP_T,t.CLAMP_TO_EDGE),null!=this.depthTextureExt&&t.texImage2D(t.TEXTURE_2D,0,t.DEPTH_COMPONENT,this.width,this.height,0,t.DEPTH_COMPONENT,t.UNSIGNED_SHORT,null),t.framebufferTexture2D(t.FRAMEBUFFER,t.COLOR_ATTACHMENT0,t.TEXTURE_2D,this.texture,0),null==this.depthTextureExt){console.log("no depth texture");var e=t.createRenderbuffer();t.bindRenderbuffer(t.RENDERBUFFER,e),t.renderbufferStorage(t.RENDERBUFFER,t.DEPTH_COMPONENT16,this.frameBuffer.width,this.frameBuffer.height),t.framebufferRenderbuffer(t.FRAMEBUFFER,t.DEPTH_ATTACHMENT,t.RENDERBUFFER,e)}else t.framebufferTexture2D(t.FRAMEBUFFER,t.DEPTH_ATTACHMENT,t.TEXTURE_2D,this.depthTexture,0);t.bindTexture(t.TEXTURE_2D,null),t.bindRenderbuffer(t.RENDERBUFFER,null),t.bindFramebuffer(t.FRAMEBUFFER,null)},r.bind=function(){t.bindFramebuffer(t.FRAMEBUFFER,this.frameBuffer)},r.unbind=function(){t.bindFramebuffer(t.FRAMEBUFFER,null)},r.getTexture=function(){return this.glTexture},r.getDepthTexture=function(){return this.glDepthTexture},bongiovi.FrameBuffer=s}()},{}],6:[function(){!function(){var t=function(t,i){this.gl=bongiovi.GL.gl,this.idVertex=t,this.idFragment=i,this.parameters=[],this.uniformTextures=[],this.vertexShader=void 0,this.fragmentShader=void 0,this._isReady=!1,this._loadedCount=0,this.init()},i=t.prototype;i.init=function(){this.getShader(this.idVertex,!0),this.getShader(this.idFragment,!1)},i.getShader=function(t,i){var e=new XMLHttpRequest;e.hasCompleted=!1;var s=this;e.onreadystatechange=function(t){4==t.target.readyState&&(i?s.createVertexShaderProgram(t.target.responseText):s.createFragmentShaderProgram(t.target.responseText))},e.open("GET",t,!0),e.send(null)},i.createVertexShaderProgram=function(t){var i=this.gl.createShader(this.gl.VERTEX_SHADER);return this.gl.shaderSource(i,t),this.gl.compileShader(i),this.gl.getShaderParameter(i,this.gl.COMPILE_STATUS)?(this.vertexShader=i,void 0!=this.vertexShader&&void 0!=this.fragmentShader&&this.attachShaderProgram(),void this._loadedCount++):(console.warn(this.gl.getShaderInfoLog(i)),null)},i.createFragmentShaderProgram=function(t){var i=this.gl.createShader(this.gl.FRAGMENT_SHADER);return this.gl.shaderSource(i,t),this.gl.compileShader(i),this.gl.getShaderParameter(i,this.gl.COMPILE_STATUS)?(this.fragmentShader=i,void 0!=this.vertexShader&&void 0!=this.fragmentShader&&this.attachShaderProgram(),void this._loadedCount++):(console.warn(this.gl.getShaderInfoLog(i)),null)},i.attachShaderProgram=function(){this._isReady=!0,this.shaderProgram=this.gl.createProgram(),this.gl.attachShader(this.shaderProgram,this.vertexShader),this.gl.attachShader(this.shaderProgram,this.fragmentShader),this.gl.linkProgram(this.shaderProgram)},i.bind=function(){this._isReady&&(this.gl.useProgram(this.shaderProgram),void 0==this.shaderProgram.pMatrixUniform&&(this.shaderProgram.pMatrixUniform=this.gl.getUniformLocation(this.shaderProgram,"uPMatrix")),void 0==this.shaderProgram.mvMatrixUniform&&(this.shaderProgram.mvMatrixUniform=this.gl.getUniformLocation(this.shaderProgram,"uMVMatrix")),bongiovi.GLTool.setShader(this),bongiovi.GLTool.setShaderProgram(this.shaderProgram),this.uniformTextures=[])},i.isReady=function(){return this._isReady},i.uniform=function(t,i,e){if(this._isReady){"texture"==i&&(i="uniform1i");for(var s,r=!1,o=0;o<this.parameters.length;o++)if(s=this.parameters[o],s.name==t){s.value=e,r=!0;break}r?this.shaderProgram[t]=s.uniformLoc:(this.shaderProgram[t]=this.gl.getUniformLocation(this.shaderProgram,t),this.parameters.push({name:t,type:i,value:e,uniformLoc:this.shaderProgram[t]})),-1==i.indexOf("Matrix")?this.gl[i](this.shaderProgram[t],e):this.gl[i](this.shaderProgram[t],!1,e),"uniform1i"==i&&(this.uniformTextures[e]=this.shaderProgram[t])}},i.unbind=function(){},bongiovi.GLShader=t}()},{}],7:[function(){!function(){var t,i,e=function(t){return!(0==t||t&t-1)},s=function(s,r,o){r=r||!1,o=o||{},t=bongiovi.GL.gl,i=bongiovi.GL,r?this.texture=s:(this.texture=t.createTexture(),this._isVideo="VIDEO"==s.tagName,this.magFilter=o.magFilter||t.LINEAR,this.minFilter=o.minFilter||t.LINEAR_MIPMAP_NEAREST,this.wrapS=o.wrapS||t.MIRRORED_REPEAT,this.wrapT=o.wrapT||t.MIRRORED_REPEAT,s.width&&(e(s.width)&&e(s.height)||(this.wrapS=this.wrapT=t.CLAMP_TO_EDGE,this.minFilter==t.LINEAR_MIPMAP_NEAREST&&(this.minFilter=t.LINEAR))),t.bindTexture(t.TEXTURE_2D,this.texture),t.pixelStorei(t.UNPACK_FLIP_Y_WEBGL,!0),t.texImage2D(t.TEXTURE_2D,0,t.RGBA,t.RGBA,t.UNSIGNED_BYTE,s),this._isVideo?(t.texParameteri(t.TEXTURE_2D,t.TEXTURE_MAG_FILTER,this.magFilter),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_MIN_FILTER,this.minFilter),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_WRAP_S,this.wrapS),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_WRAP_T,this.wrapT),this.minFilter==t.LINEAR_MIPMAP_NEAREST&&t.generateMipmap(t.TEXTURE_2D)):(t.texParameteri(t.TEXTURE_2D,t.TEXTURE_MAG_FILTER,this.magFilter),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_MIN_FILTER,this.minFilter),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_WRAP_S,this.wrapS),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_WRAP_T,this.wrapT),this.minFilter==t.LINEAR_MIPMAP_NEAREST&&t.generateMipmap(t.TEXTURE_2D)),t.bindTexture(t.TEXTURE_2D,null))},r=s.prototype;r.updateTexture=function(i){t.bindTexture(t.TEXTURE_2D,this.texture),t.pixelStorei(t.UNPACK_FLIP_Y_WEBGL,!0),t.texImage2D(t.TEXTURE_2D,0,t.RGBA,t.RGBA,t.UNSIGNED_BYTE,i),this._isVideo?(t.texParameteri(t.TEXTURE_2D,t.TEXTURE_MAG_FILTER,t.LINEAR),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_MIN_FILTER,t.LINEAR)):(t.texParameteri(t.TEXTURE_2D,t.TEXTURE_MAG_FILTER,t.LINEAR),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_MIN_FILTER,t.LINEAR_MIPMAP_NEAREST),this.minFilter==t.LINEAR_MIPMAP_NEAREST&&t.generateMipmap(t.TEXTURE_2D)),t.bindTexture(t.TEXTURE_2D,null)},r.bind=function(e){void 0==e&&(e=0),t.activeTexture(t.TEXTURE0+e),t.bindTexture(t.TEXTURE_2D,this.texture),t.uniform1i(i.shader.uniformTextures[e],e),this._bindIndex=e},r.unbind=function(){t.bindTexture(t.TEXTURE_2D,null)},bongiovi.GLTexture=s}()},{}],8:[function(){bongiovi=window.bongiovi||{},function(){var t=null,i=function(){this.aspectRatio=window.innerWidth/window.innerHeight,this.fieldOfView=45,this.zNear=5,this.zFar=3e3,this.canvas=null,this.gl=null,this.W=0,this.H=0,this.shader=null,this.shaderProgram=null},e=i.prototype;e.init=function(t){this.canvas=t,this.gl=this.canvas.getContext("experimental-webgl",{antialias:!0}),this.resize();this.gl.getParameter(this.gl.SAMPLES),this.gl.getContextAttributes().antialias;this.gl.viewport(0,0,this.gl.viewportWidth,this.gl.viewportHeight),this.gl.enable(this.gl.DEPTH_TEST),this.gl.enable(this.gl.CULL_FACE),this.gl.enable(this.gl.BLEND),this.gl.clearColor(0,0,0,1),this.gl.clearDepth(1),this.matrix=mat4.create(),mat4.identity(this.matrix),this.depthTextureExt=this.gl.getExtension("WEBKIT_WEBGL_depth_texture"),this.floatTextureExt=this.gl.getExtension("OES_texture_float"),this.enableAlphaBlending();var i=this;window.addEventListener("resize",function(){i.resize()})},e.getGL=function(){return this.gl},e.setShader=function(t){this.shader=t},e.setShaderProgram=function(t){this.shaderProgram=t},e.setViewport=function(t,i,e,s){this.gl.viewport(t,i,e,s)},e.setMatrices=function(t){this.camera=t},e.rotate=function(t){mat4.copy(this.matrix,t)},e.render=function(){null!=this.shaderProgram&&(this.gl.clear(this.gl.COLOR_BUFFER_BIT|this.gl.DEPTH_BUFFER_BIT),this.gl.blendFunc(this.gl.SRC_ALPHA,this.gl.ONE_MINUS_SRC_ALPHA))},e.enableAlphaBlending=function(){this.gl.blendFunc(this.gl.SRC_ALPHA,this.gl.ONE_MINUS_SRC_ALPHA)},e.enableAdditiveBlending=function(){this.gl.blendFunc(this.gl.ONE,this.gl.ONE)},e.clear=function(t,i,e,s){this.gl.clearColor(t,i,e,s),this.gl.clear(this.gl.COLOR_BUFFER_BIT|this.gl.DEPTH_BUFFER_BIT)},e.draw=function(t){function i(t,i,e){return void 0==i.cacheAttribLoc&&(i.cacheAttribLoc={}),void 0==i.cacheAttribLoc[e]&&(i.cacheAttribLoc[e]=t.getAttribLocation(i,e)),i.cacheAttribLoc[e]}this.gl.uniformMatrix4fv(this.shaderProgram.pMatrixUniform,!1,this.camera.getMatrix()),this.gl.uniformMatrix4fv(this.shaderProgram.mvMatrixUniform,!1,this.matrix),this.gl.bindBuffer(this.gl.ARRAY_BUFFER,t.vBufferPos);var e=i(this.gl,this.shaderProgram,"aVertexPosition");this.gl.vertexAttribPointer(e,t.vBufferPos.itemSize,this.gl.FLOAT,!1,0,0),this.gl.enableVertexAttribArray(e),this.gl.bindBuffer(this.gl.ARRAY_BUFFER,t.vBufferUV);var s=i(this.gl,this.shaderProgram,"aTextureCoord");this.gl.vertexAttribPointer(s,t.vBufferUV.itemSize,this.gl.FLOAT,!1,0,0),this.gl.enableVertexAttribArray(s),this.gl.bindBuffer(this.gl.ELEMENT_ARRAY_BUFFER,t.iBuffer);for(var r=0;r<t.extraAttributes.length;r++){this.gl.bindBuffer(this.gl.ARRAY_BUFFER,t.extraAttributes[r].buffer);var o=i(this.gl,this.shaderProgram,t.extraAttributes[r].name);this.gl.vertexAttribPointer(o,t.extraAttributes[r].itemSize,this.gl.FLOAT,!1,0,0),this.gl.enableVertexAttribArray(o)}t.drawType==this.gl.POINTS?this.gl.drawArrays(t.drawType,0,t.vertexSize):this.gl.drawElements(t.drawType,t.iBuffer.numItems,this.gl.UNSIGNED_SHORT,0)},e.resize=function(){this.W=window.innerWidth,this.H=window.innerHeight,this.canvas.width=this.W,this.canvas.height=this.H,this.gl.viewportWidth=this.W,this.gl.viewportHeight=this.H,this.gl.viewport(0,0,this.W,this.H),this.aspectRatio=window.innerWidth/window.innerHeight,this.render()},i.getInstance=function(){return null==t&&(t=new i),t},bongiovi.GL=i.getInstance(),bongiovi.GLTool=i.getInstance()}()},{}],9:[function(){!function(){var t=function(t,i,e){this.gl=bongiovi.GLTool.gl,this.vertexSize=t,this.indexSize=i,this.drawType=e,this.extraAttributes=[],this.vBufferPos=void 0,this._floatArrayVertex=void 0,this._init()},i=t.prototype;i._init=function(){},i.bufferVertex=function(t){for(var i=[],e=0;e<t.length;e++)for(var s=0;s<t[e].length;s++)i.push(t[e][s]);if(void 0==this.vBufferPos&&(this.vBufferPos=this.gl.createBuffer()),this.gl.bindBuffer(this.gl.ARRAY_BUFFER,this.vBufferPos),void 0==this._floatArrayVertex)this._floatArrayVertex=new Float32Array(i);else if(t.length!=this._floatArrayVertex.length)this._floatArrayVertex=new Float32Array(i);else for(var e=0;e<t.length;e++)this._floatArrayVertex[e]=t[e];this.gl.bufferData(this.gl.ARRAY_BUFFER,this._floatArrayVertex,this.gl.STATIC_DRAW),this.vBufferPos.itemSize=3},i.bufferTexCoords=function(t){for(var i=[],e=0;e<t.length;e++)for(var s=0;s<t[e].length;s++)i.push(t[e][s]);this.vBufferUV=this.gl.createBuffer(),this.gl.bindBuffer(this.gl.ARRAY_BUFFER,this.vBufferUV),this.gl.bufferData(this.gl.ARRAY_BUFFER,new Float32Array(i),this.gl.STATIC_DRAW),this.vBufferUV.itemSize=2},i.bufferData=function(t,i,e){for(var s=-1,r=0;r<this.extraAttributes.length;r++)if(this.extraAttributes[r].name==i){this.extraAttributes[r].data=t,s=r;break}for(var o=[],r=0;r<t.length;r++)for(var n=0;n<t[r].length;n++)o.push(t[r][n]);if(-1==s){var a=this.gl.createBuffer();this.gl.bindBuffer(this.gl.ARRAY_BUFFER,a);var h=new Float32Array(o);this.gl.bufferData(this.gl.ARRAY_BUFFER,h,this.gl.STATIC_DRAW),this.extraAttributes.push({name:i,data:t,itemSize:e,buffer:a,floatArray:h})}else{var a=this.extraAttributes[s].buffer;this.gl.bindBuffer(this.gl.ARRAY_BUFFER,a);for(var h=this.extraAttributes[s].floatArray,r=0;r<o.length;r++)h[r]=o[r];this.gl.bufferData(this.gl.ARRAY_BUFFER,h,this.gl.STATIC_DRAW)}},i.bufferIndices=function(t){this.iBuffer=this.gl.createBuffer(),this.gl.bindBuffer(this.gl.ELEMENT_ARRAY_BUFFER,this.iBuffer),this.gl.bufferData(this.gl.ELEMENT_ARRAY_BUFFER,new Uint16Array(t),this.gl.STATIC_DRAW),this.iBuffer.itemSize=1,this.iBuffer.numItems=t.length},bongiovi.Mesh=t}()},{}],10:[function(){!function(){var t,i,e=function(e,s,r){t=bongiovi.GL.gl,i=bongiovi.GL,void 0!=e&&(this.view="string"==typeof e?new bongiovi.ViewCopy("assets/shaders/copy.vert",e):e,this.width=void 0==s?512:s,this.height=void 0==r?512:r,this._init())},s=e.prototype;s._init=function(){this.fbo=new bongiovi.FrameBuffer(this.width,this.height),this.fbo.bind(),i.setViewport(0,0,this.fbo.width,this.fbo.height),i.clear(0,0,0,0),this.fbo.unbind()},s.render=function(t){return i.setViewport(0,0,this.fbo.width,this.fbo.height),this.fbo.bind(),i.clear(0,0,0,0),this.view.render(t),this.fbo.unbind(),this.fbo.getTexture()},s.getTexture=function(){return this.fbo.getTexture()},bongiovi.Pass=e}()},{}],11:[function(){!function(){var t=function(){this.gl=bongiovi.GLTool.gl,this._init()},i=t.prototype;i._init=function(){this.camera=new bongiovi.CameraPerspective,this.camera.setPerspective(45,window.innerWidth/window.innerHeight,5,3e3);var t=vec3.clone([0,0,500]),i=vec3.create(),e=vec3.clone([0,-1,0]);this.camera.lookAt(t,i,e),this.sceneRotation=new bongiovi.SceneRotation,this.rotationFront=mat4.create(),mat4.identity(this.rotationFront),this.cameraOtho=new bongiovi.Camera,this._initTextures(),this._initViews()},i._initTextures=function(){},i._initViews=function(){},i.loop=function(){this.update(),this.render()},i.update=function(){this.gl.clear(this.gl.COLOR_BUFFER_BIT|this.gl.DEPTH_BUFFER_BIT),this.sceneRotation.update(),bongiovi.GLTool.setMatrices(this.camera),bongiovi.GLTool.rotate(this.sceneRotation.matrix)},i.render=function(){},bongiovi.Scene=t}()},{}],12:[function(){bongiovi=window.bongiovi||{},function(){var t=function(t){void 0==t&&(t=document),this._z=0,this._mouseZ=0,this._preZ=0,this._isRotateZ=0,this.matrix=mat4.create(),this.m=mat4.create(),this._vZaxis=vec3.clone([0,0,0]),this._zAxis=vec3.clone([0,0,-1]),this.preMouse={x:0,y:0},this.mouse={x:0,y:0},this._isMouseDown=!1,this._rotation=quat.clone([0,0,1,0]),this.tempRotation=quat.clone([0,0,0,0]),this._rotateZMargin=0,this.diffX=0,this.diffY=0,this._currDiffX=0,this._currDiffY=0,this._offset=.004,this._easing=.1,this._slerp=-1,this._isLocked=!1;var i=this;t.addEventListener("mousedown",function(t){i._onMouseDown(t)}),t.addEventListener("touchstart",function(t){i._onMouseDown(t)}),t.addEventListener("mouseup",function(t){i._onMouseUp(t)}),t.addEventListener("touchend",function(t){i._onMouseUp(t)}),t.addEventListener("mousemove",function(t){i._onMouseMove(t)}),t.addEventListener("touchmove",function(t){i._onMouseMove(t)}),t.addEventListener("mousewheel",function(t){i._onMouseWheel(t)}),t.addEventListener("DOMMouseScroll",function(t){i._onMouseWheel(t)})},i=t.prototype;i.lock=function(t){this._isLocked=t},i.getMousePos=function(t){var i,e;return void 0!=t.changedTouches?(i=t.changedTouches[0].pageX,e=t.changedTouches[0].pageY):(i=t.clientX,e=t.clientY),{x:i,y:e}},i._onMouseDown=function(t){if(!this._isLocked&&!this._isMouseDown){var i=this.getMousePos(t),e=quat.clone(this._rotation);this._updateRotation(e),this._rotation=e,this._isMouseDown=!0,this._isRotateZ=0,this.preMouse={x:i.x,y:i.y},i.y<this._rotateZMargin||i.y>window.innerHeight-this._rotateZMargin?this._isRotateZ=1:(i.x<this._rotateZMargin||i.x>window.innerWidth-this._rotateZMargin)&&(this._isRotateZ=2),this._z=this._preZ,this._currDiffX=this.diffX=0,this._currDiffY=this.diffY=0}},i._onMouseMove=function(t){this._isLocked||(this.mouse=this.getMousePos(t))},i._onMouseUp=function(){this._isLocked||this._isMouseDown&&(this._isMouseDown=!1)},i._onMouseWheel=function(t){if(!this._isLocked){t.preventDefault();var i=t.wheelDelta,e=t.detail,s=0;s=e?i?i/e/40*e>0?1:-1:-e/3:i/120,this._preZ-=5*s}},i.setCameraPos=function(t){if(console.log("Set camera pos : ",t),!(this._slerp>0)){var i=t.clone(this._rotation);this._updateRotation(i),this._rotation=t.clone(i),this._currDiffX=this.diffX=0,this._currDiffY=this.diffY=0,this._isMouseDown=!1,this._isRotateZ=0,this._targetQuat=t.clone(t),this._slerp=1}},i.resetQuat=function(){this._rotation=quat.clone([0,0,1,0]),this.tempRotation=quat.clone([0,0,0,0]),this._targetQuat=void 0,this._slerp=-1},i.update=function(){mat4.identity(this.m),void 0==this._targetQuat?(quat.set(this.tempRotation,this._rotation[0],this._rotation[1],this._rotation[2],this._rotation[3]),this._updateRotation(this.tempRotation)):(this._slerp+=.1*(0-this._slerp),this._slerp<.001?(quat.set(this._rotation,this._targetQuat[0],this._targetQuat[1],this._targetQuat[2],this._targetQuat[3]),this._targetQuat=void 0,this._slerp=-1):(quat.set(this.tempRotation,0,0,0,0),quat.slerp(this.tempRotation,this._targetQuat,this._rotation,this._slerp))),vec3.set(this._vZaxis,0,0,this._z),vec3.transformQuat(this._vZaxis,this._vZaxis,this.tempRotation),mat4.translate(this.m,this.m,this._vZaxis);Math.random()>.95;mat4.fromQuat(this.matrix,this.tempRotation),mat4.multiply(this.matrix,this.matrix,this.m)};i._updateRotation=function(t){if(this._isMouseDown&&!this._isLocked&&(this.diffX=this.mouse.x-this.preMouse.x,this.diffY=-(this.mouse.y-this.preMouse.y),this._isInvert&&(this.diffX=-this.diffX),this._isInvert&&(this.diffY=-this.diffY)),this._currDiffX+=(this.diffX-this._currDiffX)*this._easing,this._currDiffY+=(this.diffY-this._currDiffY)*this._easing,this._isRotateZ>0)if(1==this._isRotateZ){var i=-this._currDiffX*this._offset;i*=this.preMouse.y<this._rotateZMargin?-1:1;var e=quat.clone([0,0,Math.sin(i),Math.cos(i)]);quat.multiply(quat,t,e)}else{var i=-this._currDiffY*this._offset;i*=this.preMouse.x<this._rotateZMargin?1:-1;var e=quat.clone([0,0,Math.sin(i),Math.cos(i)]);quat.multiply(quat,t,e)}else{var s=vec3.clone([this._currDiffX,this._currDiffY,0]),r=vec3.create();vec3.cross(r,s,this._zAxis),vec3.normalize(r,r);var i=vec3.length(s)*this._offset,e=quat.clone([Math.sin(i)*r[0],Math.sin(i)*r[1],Math.sin(i)*r[2],Math.cos(i)]);quat.multiply(t,e,t)}this._z+=(this._preZ-this._z)*this._easing},bongiovi.SceneRotation=t}()},{}],13:[function(){bongiovi=window.bongiovi||{},void 0==window.requestAnimFrame&&(window.requestAnimFrame=function(){return window.requestAnimationFrame||window.webkitRequestAnimationFrame||window.mozRequestAnimationFrame||window.oRequestAnimationFrame||window.msRequestAnimationFrame||function(t){window.setTimeout(t,1e3/60)}}()),function(){var t=function(){this.FRAMERATE=60,this._delayTasks=[],this._nextTasks=[],this._deferTasks=[],this._highTasks=[],this._usurpTask=[],this._enterframeTasks=[],this._idTable=0,requestAnimFrame(this._loop.bind(this))},i=t.prototype;i._loop=function(){requestAnimFrame(this._loop.bind(this)),this._process()},i._process=function(){for(var t=0;t<this._enterframeTasks.length;t++){var i=this._enterframeTasks[t];null!=i&&void 0!=i&&i.func.apply(i.scope,i.params)}for(;this._highTasks.length>0;){var e=this._highTasks.pop();e.func.apply(e.scope,e.params)}for(var s=(new Date).getTime(),t=0;t<this._delayTasks.length;t++){var e=this._delayTasks[t];s-e.time>e.delay&&(e.func.apply(e.scope,e.params),this._delayTasks.splice(t,1))}s=(new Date).getTime();for(var r=1e3/this.FRAMERATE;this._deferTasks.length>0;){var i=this._deferTasks.shift(),o=(new Date).getTime();if(!(r>o-s)){this._deferTasks.unshift(i);break}i.func.apply(i.scope,i.params)}s=(new Date).getTime();for(var r=1e3/this.FRAMERATE;this._usurpTask.length>0;){var i=this._usurpTask.shift(),o=(new Date).getTime();if(!(r>o-s))break;i.func.apply(i.scope,i.params)}this._highTasks=this._highTasks.concat(this._nextTasks),this._nextTasks=[],this._usurpTask=[]},i.addEF=function(t,i,e){e=e||[];var s=this._idTable;return this._enterframeTasks[s]={scope:t,func:i,params:e},this._idTable++,s},i.removeEF=function(t){return void 0!=this._enterframeTasks[t]&&(this._enterframeTasks[t]=null),-1},i.delay=function(t,i,e,s){var r=(new Date).getTime(),o={scope:t,func:i,params:e,delay:s,time:r};this._delayTasks.push(o)},i.defer=function(t,i,e){var s={scope:t,func:i,params:e};this._deferTasks.push(s)},i.next=function(t,i,e){var s={scope:t,func:i,params:e};this._nextTasks.push(s)},i.usurp=function(t,i,e){var s={scope:t,func:i,params:e};this._usurpTask.push(s)},bongiovi.Scheduler=new t}()},{}],14:[function(){bongiovi=window.bongiovi||{},function(){SimpleImageLoader=function(){this._imgs={},this._loadedCount=0,this._toLoadCount=0,this._scope,this._callback,this._callbackProgress};var t=SimpleImageLoader.prototype;t.load=function(t,i,e,s){this._imgs={},this._loadedCount=0,this._toLoadCount=t.length,this._scope=i,this._callback=e,this._callbackProgress=s;for(var r=this,o=0;o<t.length;o++){var n=new Image;n.onload=function(){r._onImageLoaded()};var a=t[o],h=a.split("/"),u=h[h.length-1].split(".")[0];this._imgs[u]=n,n.src=a}},t._onImageLoaded=function(){if(this._loadedCount++,this._loadedCount==this._toLoadCount)this._callback.call(this._scope,this._imgs);else{var t=this._loadedCount/this._toLoadCount;this._callbackProgress&&this._callbackProgress.call(this._scope,t)}}}(),bongiovi.SimpleImageLoader=new SimpleImageLoader},{}],15:[function(){!function(){var t=function(t,i){void 0!=t&&(this.shader=new bongiovi.GLShader(t,i),this._init())},i=t.prototype;i._init=function(){console.log("Should be overwritten by SuperClass")},i.render=function(){console.log("Should be overwritten by SuperClass")},bongiovi.View=t}()},{}],16:[function(){!function(){{var t=bongiovi.View,i=function(i,e){void 0==i&&(i="assets/shaders/copy.vert",e="assets/shaders/copy.frag"),t.call(this,i,e)},e=i.prototype=new t;t.prototype}e._init=function(){var t=[],i=[],e=[0,1,2,0,2,3],s=1;t.push([-s,-s,0]),t.push([s,-s,0]),t.push([s,s,0]),t.push([-s,s,0]),i.push([0,0]),i.push([1,0]),i.push([1,1]),i.push([0,1]),this.mesh=new bongiovi.Mesh(4,6,bongiovi.GLTool.gl.TRIANGLES),this.mesh.bufferVertex(t),this.mesh.bufferTexCoords(i),this.mesh.bufferIndices(e)},e.render=function(t){this.shader.isReady()&&(this.shader.bind(),this.shader.uniform("texture","uniform1i",0),t.bind(0),bongiovi.GLTool.draw(this.mesh))},bongiovi.ViewCopy=i}()},{}]},{},[1]);
>>>>>>> ace8ab55cc1149c49fee56e752b1fd2dcad96883
